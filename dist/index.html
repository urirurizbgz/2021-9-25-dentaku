<!DOCTYPE html>
<html lang="jp">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Chango&family=Londrina+Shadow&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="style.css" />

		<title>Dentaku</title>
	</head>
	<body class="font-Chango">
		<div class="container">
			<!-- main -->
			<div class="bg-chocolate-b text-chocolate-lb text-7xl">
				<!-- display -->
				<div class="btn justify-end">
					<p id="display" class="text-chocolate-lb text-3xl md:text-6xl"></p>
				</div>
				<!-- AC C -->
				<div class="flex">
					<div onclick="allClear()" id="ac" class="btn justify-center">
						<p>AC</p>
					</div>
					<div onclick="pressClear()" id="c" class="btn justify-center">
						<p>C</p>
					</div>
				</div>
				<!-- 7 8 9 ÷ -->
				<div class="flex">
					<div onclick="inNumber(7)" id="num7" class="btn justify-center">
						<p>7</p>
					</div>
					<div onclick="inNumber(8)" id="num8" class="btn justify-center">
						<p>8</p>
					</div>
					<div onclick="inNumber(9)" id="num9" class="btn justify-center">
						<p>9</p>
					</div>
					<div onclick="inArit('/')" id="arit4" class="btn justify-center">
						<p>÷</p>
					</div>
				</div>
				<!-- 4 5 6 × -->
				<div class="flex">
					<div onclick="inNumber(4)" id="num4" class="btn justify-center">
						<p>4</p>
					</div>
					<div onclick="inNumber(5)" id="num5" class="btn justify-center">
						<p>5</p>
					</div>
					<div onclick="inNumber(6)" id="num6" class="btn justify-center">
						<p>6</p>
					</div>
					<div onclick="inArit('*')" id="arit3" class="btn justify-center">
						<p>×</p>
					</div>
				</div>
				<!-- 1 2 3 - -->
				<div class="flex">
					<div onclick="inNumber(1)" id="num1" class="btn justify-center">
						<p>1</p>
					</div>

					<div onclick="inNumber(2)" id="num2" class="btn justify-center">
						<p>2</p>
					</div>
					<div onclick="inNumber(3)" id="num3" class="btn justify-center">
						<p>3</p>
					</div>
					<div onclick="inArit('-')" id="arit2" class="btn justify-center">
						<p>-</p>
					</div>
				</div>
				<!-- 0 = - -->
				<div class="flex">
					<div onclick="inNumber(0)" id="num0" class="btn justify-center">
						<p>0</p>
					</div>
					<div onclick="pressEqual()" id="equal" class="btn justify-center">
						<p>=</p>
					</div>
					<div onclick="inArit('+')" id="arit1" class="btn justify-center">
						<p>+</p>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script>
		/*
		やること：
		詳細：
		引数：
		返り値：
		*/

		var stack = [];
		let number, arit, status;

		allClear();
		display(number);
		// putLog();

		/*
		function allClear()
		やること：四つの変数を初期値にする
		詳細：status=1,number=0,arit="+",stack=[],にする
		引数：なし
		返り値：なし
		*/
		function allClear() {
			//status=1,number=0,arit="+",stack=[],にする
			status = 1;
			number = 0;
			arit = "+";
			stack = [];
			display(number);
			statusCheck("allClear");
		}

		/*
		function pressClear()
		やること：現在入力されている数を0にして再入力できるようにする
		詳細：
			1→1：numberを0にする　numberを表示　status=1にする
			2→1：numberを0にする　numberを表示　status=1にする
			3→1：allClearを呼ぶ
			4→1：allClearを呼ぶ
		引数：なし
		返り値：なし
		*/
		function pressClear() {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			switch (status) {
				case 1: //前回入力していたのが数だったら
					number = 0;
					status = 1;
					display(number);
					break;
				case 2: //前回入力していたのが記号だったら
					number = 0;
					status = 1;
					display(number);
					break;
				case 3: //前回入力していたのが＝だったら
					allClear();
					break;
				default:
					//前回,エラーが起こっていたら
					allClear();
					break;
			}

			statusCheck("pressClear");
		}

		/*
		function display(num)
		やること：渡された引数を画面の指定位置に表示する
		詳細：渡された引数を画面の指定位置に表示する（textContent
		引数：num::数値か文字列
		返り値：？
		*/
		function display(num) {
			//指定されたidの場所に引数numの内容を表示する
			document.getElementById("display").textContent = num;
		}

		/*
		function inNumber(input)
		やること：渡された引数を加工し正しいタイミングで記号とともにプッシュ
		詳細：パターン：1→1, 2→1, 3→1, 4→1
			1→1：number=number*10+input,numberをdisplay関数に渡す。status=1にする。
			2→1：number,arit をプッシュ。number=inputする。numberをdisplay関数に渡す。status=1にする。
			3→1：allClear関数を呼ぶ、number=inputする。numberをdisplay関数に渡す。status=1にする。
			4→1：allClear関数を呼ぶ、number=inputする。numberをdisplay関数に渡す。status=1にする。
		引数：input:数値：ボタンで入力される数
		返り値：number
		*/
		function inNumber(input) {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			switch (status) {
				case 1: //前回入力していたのが数だったら
					number = number * 10 + input;
					break;
				case 2: //前回入力していたのが記号だったら
					stack.push(number, arit);

					number = input;
					break;

				default:
					//前回,エラーが起こっていたら//前回入力していたのが＝だったら
					console.log("ninumdef");
					allClear();
					number = input;
					break;
			}
			// status1にする
			status = 1;
			//表示する
			display(number);
			statusCheck("inNumber");
			// リターン number
			return number;
		}

		/*
		function inArit(input) {}
		やること：渡された引数を変数に保存しTemporary関数を呼ぶ
		詳細：
			1→2：stack,number,aritをtemporayに渡す、arit=inputする。status=2する
			2→2：stack,number,aritをtemporayに渡す、arit=inputする。status=2する
			3→2：arit=inputする。status=2する
			4→4：何もしない
		引数：input:文字列
		返り値：arit
		*/
		function inArit(input) {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			switch (status) {
				case 1: //前回入力していたのが数だったら
				case 2: //前回入力していたのが記号だったら
					arit = input;
					status = 2;
					temporary(stack.concat(), number, arit);

					break;
				case 3: //前回入力していたのが＝だったら
					arit = input;
					//number = 0; ///////////1+2=(3),*3 =(15)になってしまう（正しくは9）、そのための対処として追加
					status = 2;
					break;
				default:
					//前回,エラーが起こっていたら
					//何もしない
					break;
			}
			statusCheck("inArit");
			// return arit
			return arit;
		}

		/*
		function pressEqual()
		やること：記号や文字をプッシュしてスタックをcalに渡す
		詳細：
			1→3：numberプッシュ、stackをcal関数に渡す、cal関数の返り値を表示
			2→3：number、aritプッシュ、stackをcal関数に渡す、cal関数の返り値を表示
			3→3：number、aritプッシュ、stackをcal関数に渡す、cal関数の返り値を表示
			4→4：何もしない
		引数：なし
		返り値：？
		*/
		function pressEqual() {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			let ans;
			switch (status) {
				case 1: //前回入力していたのが数だったら
				case 2: //前回入力していたのが記号だったら
				case 3: //前回入力していたのが＝だったら
					if (status == 3) {
						stack.push(arit);
					}
					status = 3;

					stack.push(number, "=");
					try {
						ans = cal(stack);
						display(ans);
					} catch (e) {
						putError();
					}

					break;
				default:
					//前回,エラーが起こっていたら
					//何もしない
					break;
			}
			return ans;
			//statusCheck("pressEqual");
		}

		/*
		function temporary()
		やること：渡された引数を加工しcalをわたし答えを受け取り表示する
		詳細：stackにnumber,aritをpush、スタックの中身が2より多ければcal関数にstackを渡す
		引数：stack：数値か文字列, arit：記号, number：数値

		返り値：加工済みのstack
		*/
		function temporary(stackTemp, number, arit) {
			//スタックにnumberとaritをプッシュする

			stackTemp.push(number, arit);

			//もし、スタックのレンジが2より大きいなら
			if (stackTemp.length > 2) {
				//calにstackを渡す
				try {
					display(cal(stackTemp));
				} catch (e) {
					// エラーをキャッチしたら、error関数を呼ぶ
					putError();
				}
			}

			return stackTemp;
			// リターン stack
		}

		/*
		function cal()
		やること：渡された引数を計算する
		詳細：
			渡されたスタックが空になるまで以下を繰り返す
			スタックの頭から取り出して変数eに入れる
			eが記号なら変数paramにしまう
			eが数字かつ
				paramが＋なら足し算を行う
				paramがーなら引き算を行う
				paramが＊なら掛け算を行う
				paramが/なら割り算を行う　
		引数：stack：数値か文字列
		返り値：答えの入った変数になるやつ
		*/
		function cal(stack) {
			//目視OK。機械判定：ok。
			let param = "+";
			let answer = 0;
			//stackが空になるまで取り出して変数elemに入れ、elemを引数に関数を動かす。
			stack.forEach((e) => {
				switch (e) {
					//eが記号の時、変数paramにしまう
					case "/":
					case "*":
					case "-":
					case "+":
						param = e;
						break;
					case "=":
						allClear();
						number = answer;
						break;
					//eが記号以外（数字）の時で
					default:
						switch (param) {
							//かつparamが＋なら足し算を行う
							case "+":
								answer = answer + e;
								break;
							//かつparamがーならひき算を行う
							case "-":
								answer = answer - e;
								break;
							//かつparamが＊ならかけ算を行う
							case "*":
								answer = answer * e;
								break;
							//かつparamが/なら割り算を行う
							case "/":
								if (e === 0) {
									//えらー投げる
									throw "Error: divided by zero";
								}
								answer = answer / e;
								break;
						}
						break;
				}
			});
			//表示する
			return answer;
		}

		/*
		やること：エラー表示、statusを4にする
		詳細：display関数に"error"を渡す、statusを4にする（エラーが増えたらswitch文でエラー文面を変えるかもしれない）
		引数：なし（エラーが増えたら増えるかもしれない）
		返り値：（エラーが増えたらエラーにNo.振ってそれを返すかもしれない）
		*/
		function putError() {
			// display関数に"error"を渡す
			display("error");

			// status＝4する
			status = 4;
			console.log("status===4");
			statusCheck("putError");
		}

		function success(num) {
			console.log(num + "   success ◯ ◯ ◯ ◯ ◯ ◯ ◯ ◯");
		}
		function failed(num) {
			console.log(num + "   failed × × × × × × × × ×");
		}
		function putLog() {
			console.log("status : " + status);
			console.log("number : " + number);
			console.log("arit : " + arit);
			console.log("stack : " + stack);
			console.log("----------------------------------");
		}

		const test = true;
		if (test) {
			testFunc();
		}
		function testFunc() {
			/*
			inNumber(input) test
			inNumberTest(input, sta, num, ari, stc);*/
			// inNumberTest(1, 1, 2, "+", [], 21);
			// inNumberTest(1, 2, 3, "*", [1, "+", 2, "-"], [1, "+", 2, "-", 3, "*"]);
			// inNumberTest(9, 3, 3, "*", [1, "+", 2, "-"], [1, "+", 2, "-", 3, "*"]);
			// /*
			// inArit(input)test
			// inNumberTest(input, sta, num, ari, stc)*/
			// //inAritTest("-", 4, 2, "+", []);
			// /*
			// pressEqual() test
			// pressEqualTest(sta, num, ari, stc, exp)*/
			pressEqualTest(1, 2, "+", [], [2]);
			pressEqualTest(2, 2, "+", [], [2]);
			pressEqualTest(3, 2, "+", [], ["+", 2]);
			pressEqualTest(4, 2, "+", [3], [3, "+", 2]);
			pressEqualTest(5, 2, "+", [3], [3, "+", 2]);
			// /*
			// /*
			// allClear()
			// allClearTest(stc, num, ar, sta)*/
			// allClearTest([1, "+", 1], 5, "*", 1);
			// allClearTest([1, "+", 1], 5, "*", 2);
			// allClearTest([1, "+", 1], 5, "*", 3);
			// allClearTest([1, "+", 1], 5, "*", 4);
			// allClearTest([1, "+", 1], 5, "*", 5);
			// /*
			// pressClear() test
			// clearTest(stc, num, ari, sta)*/
			// clearTest([1, "+", 1], 5, "*", 1);
			// clearTest([1, "+", 1], 5, "*", 2);
			// clearTest([1, "+", 1], 5, "*", 3);
			// clearTest([1, "+", 1], 5, "*", 4);
			// clearTest([1, "+", 1], 5, "*", 5);
			// /*
			// cal(stack) test
			// calTest(stack, exp)*/
			// calTest([1, "+", 1], 2);
			// calTest([2, "-", 1], 1);
			// calTest([3, "*", 4], 12);
			// calTest([6, "/", 3], 2);
			// calTest([9999999999999, "+", 9999999999999], 19999999999998);
			// calTest([0, "-", 9999999999999], -9999999999999);
			// calTest([9999999999999, "*", 9999999999999], 9.999999999998e25);
			// calTest([9999999999999, "/", 3], 3333333333333);
			// /*
			// putError()
			// putErrorTest(stc, num, ari, sta) */
			// putErrorTest([1, "+", 1], 5, "*", 1);
			// putErrorTest([1, "+", 1], 5, "*", 2);
			// putErrorTest([1, "+", 1], 5, "*", 3);
			// putErrorTest([1, "+", 1], 5, "*", 4);
			// putErrorTest([1, "+", 1], 5, "*", 5);
			// /*
			// temporary(stackTemp, number, arit)
			// temporaryTest(sta, num, ari, stc)*/
			// //temporaryTest(1, 5, "+", [1, "+", 1]);
			// /*数字ボタン反応*/
			// clickNum();
			// clickArit();
			// clickEqual();
			// clickClear();
			// clickAllClear();
		}

		function allClearTest(stc, num, ari, sta) {
			//目視OK。機械判定：ok。
			stack = stc;
			number = num;
			arit = ari;
			status = sta;

			allClear();
			if (status === 1 && number === 0 && arit === "+" && stack.length === 0) {
				success("allClearTest : ");
			} else {
				failed("allClearTest : ");
			}
		}

		function clearTest(stc, num, ari, sta) {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			status = sta;
			number = num;
			arit = ari;
			stack = stc;
			pressClear();
			switch (sta) {
				case 1:
				case 2:
					if (
						status === 1 &&
						number === 0 &&
						arit === ari &&
						stack.toString === stc.toString
					) {
						success("clearTest : ");
					} else {
						failed("clearTest : ");
					}
					break;
				default:
					if (
						status === 1 &&
						number === 0 &&
						arit === "+" &&
						stack.length === 0
					) {
						success("clearTest : ");
					} else {
						failed("clearTest : ");
					}
					break;
			}
		}

		function inNumberTest(input, sta, num, ari, stc, exp) {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			status = sta;
			number = num;
			arit = ari;
			stack = stc;
			inNumber(input);
			switch (sta) {
				case 1:
					if (
						status === 1 &&
						number === exp &&
						arit == ari &&
						stack.toString === stc.toString
					) {
						success("inNumberTest : status : " + status);
					} else {
						failed("inNumberTest : status : " + status);
					}
					break;
				case 2:
					if (
						status === 1 &&
						number === input &&
						arit == ari &&
						stack.toString === exp.toString
					) {
						success("inNumberTest : status : " + status);
					} else {
						failed("inNumberTest : status : " + status);
					}
					break;
				default:
					if (
						(status === 1 && number === input && arit == "+" && stack,
						length === 0)
					) {
						success("inNumberTest : status : " + status);
					} else {
						failed("inNumberTest : status : " + status);
					}
					break;
			}
		}
		function inAritTest(input, sta, num, ari, stc) {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			status = sta;
			number = num;
			arit = ari;
			stack = stc;
			console.log(inArit(input));
			switch (sta) {
				case 1:
				case 2:
				case 3:
					if (
						input === arit &&
						status === 2 &&
						number === num &&
						stack.toString === stc.toString
					) {
						success("inAritTest : status : " + status);
					} else {
						failed("inAritTest : status : " + status);
					}
					break;
				default:
					if (
						status === sta &&
						number === num &&
						arit === ari &&
						stack.toString === stc.toString
					) {
						success("inAritTest : status : " + status);
					} else {
						failed("inAritTest : status : " + status);
					}
					break;
			}
		}
		function calTest(stack, exp) {
			//目視OK。機械判定：ok。

			let r = cal(stack);
			if (r == exp) {
				success("calTest : " + stack + "=" + exp + "=" + r);
			} else {
				failed("calTest : " + stack + "=" + exp + "≠" + r);
			}
			allClear();
		}

		function putErrorTest(stc, num, ari, sta) {
			//目視OK。機械判定：ok。
			status = sta;
			number = num;
			arit = ari;
			stack = stc;
			putError();
			if (status === 4) {
				success("putErrorTest : status : " + status);
			} else {
				failed("putErrorTest : status : " + status);
			}
		}
		function temporaryTest(sta, num, ari, stc) {
			let t;
			status = sta;
			number = num;
			arit = ari;
			stack = stc;
			t = temporary(stack.concat(), number, arit);
			stc.push(number, arit);
			if (stc.toString === t.toString) {
				success("temporaryTest : " + status);
			} else {
				failed("temporaryTest : " + status);
			}
		}
		function pressEqualTest(sta, num, ari, stc, exp) {
			//目視OK。機械判定：未判定。ボタン動作：未確認
			status = sta;
			number = num;
			arit = ari;
			stack = stc;
			let a = pressEqual();
			switch (sta) {
				case 1:
				case 2:
					if (
						stack.length === 0 &&
						status === 1 &&
						arit === "+" &&
						number === a
					) {
						success("pressEqualTest : status : " + status);
					} else {
						failed("pressEqualTest : status : " + status);
					}
					break;
				case 3:
					if (
						stack.length === 0 &&
						status === 1 &&
						arit === "+" &&
						number === a
					) {
						success("pressEqualTest : status : " + status);
					} else {
						failed("pressEqualTest : status : " + status);
					}
					break;
				default:
					if (
						stack.toString === stc.toString &&
						status === sta &&
						arit === ari &&
						number === num
					) {
						success("pressEqualTest : status : " + status);
					} else {
						failed("pressEqualTest : status : " + status);
					}
					break;
			}
		}

		function clickNum() {
			allClear();
			let i;
			for (i = 9; i > -1; i--) {
				document.getElementById("num" + i).click();
			}
		}
		function clickArit() {
			allClear();
			let i;
			for (i = 4; i > 0; i--) {
				document.getElementById("arit" + i).click();
				putLog();
			}
		}
		function clickEqual() {
			allClear();
			let i;

			document.getElementById("equal").click();
		}
		function clickClear() {
			document.getElementById("c").click();
		}
		function clickAllClear() {
			document.getElementById("ac").click();
		}
		function statusCheck(functionName) {
			console.log(functionName + ":status:" + status);
			putLog();
		}
	</script>
</html>
